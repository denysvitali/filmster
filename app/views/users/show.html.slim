= image_tag @user.avatar, class: 'prof-pic-lg'

h1.text-center
  = @user.username

ul.user-stats
  li
    .number-label Reviews
    .number-value= @user.reviews.count
  li#user-followers
    .number-label Followers
  li#user-following
    .number-label Following

.follow_unfollow_btn
  = binding.pry
  - if user_signed_in? && current_user.following?(@user)
    button.btn.btn-default.btn-lg 
      | Following
  - else
    button.btn.btn-default.btn-lg 
      | Follow
.grid#reviewed-movies


javascript:
  var $grid = $('.grid').masonry({
  // options
  itemSelector: '.grid-item',
  // use element for option
  columnWidth: 200,
  percentPosition: true
  });
  // layout Masonry after each image loads
  $grid.imagesLoaded().progress( function() {
    $grid.masonry('layout');
  });
  
  let user_id = #{@user.id};
  $.ajax({
    url: '/users/' + user_id + '.json',
    type: 'GET'
  })
  .done(function(data){
    displayReviews(data);
  });

  function displayReviews(data){
    let container = $(".grid#reviewed-movies");
    let htmlString = "";

    container.empty();
    console.log(data);
    //check if the API responds back with an error i.e. no data found.
    if (data["reviews"].length == 0) {
      htmlString = `<div class="alert alert-danger text-center" role="alert">No Data Found!</div>`
    }
    else{
      data["reviews"].forEach(function(review){
        htmlString += `
                      <div class="grid-item">
                        <a href="/movies/${review["movie"]["tmdb_id"]}">
                          <img src=${review["movie"]["poster"] == null ? "/assets/default_image.png" : "https://image.tmdb.org/t/p/w150/" + review["movie"]["poster"]} data-id="${review['movie']['tmdb_id']}"/>
                          <p>${review["movie"]["title"]}</p>
                        </a>
                      </div>
                      `
      });
    }
    container.append(htmlString);
    container.masonry('reloadItems');
    
    container.imagesLoaded(function(){
      container.masonry('layout');
    });
  }
  
